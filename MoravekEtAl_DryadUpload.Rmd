---
title: "MoravekEtAl_DryadUpload"
output: html_document
date: "2024-01-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Data wrangling packages
library(tidyverse)
library(dplyr)
library(ggplot2)
library(lubridate)
library(patchwork)
library(astsa)
library(weathermetrics)
library(report)
library(car)
library(multcomp)
library(MetBrewer)
library(multcompView)
library(xtable)
library(forcats)

# Time series analysis packages
library(MARSS)
library(MASS)
library(forecast)
library(zoo)
library(imputeTS)

```

#DATASETS
```{r}
#POND TEMPERATURE DATA
##Pond and creek temperature data were obtained via a series of temperature sensors (HOBO MX2201) placed in  9 ponds and 2 creeks from July 2020-July 2021. Water temperature was measured every 15 minutes. Sensors in the same pond or creek were averaged to create a single time series for each site. 
##Klamath River temperature data was collected by the Karuk Tribe and accessed with permission from the Karuk Tribe Water Quality Department (Accessed 27 September 2022). We used data between May 2020 and February 2021. We used a combination of data readings from the Seiad Valley station as well as interpolated data using a linear regression from the Orleans station when Seiad Valley data was unavailable (5.5% of Seiad Valley data was interpolated). Water temperature was measured every hour.  

quarterHour_condensed <- readRDS("quarterHour_condensed.rds") #Matrix of 15 min temperatures
daily_means_condensed <- readRDS("daily_means_condensed.rds") #Matrix of mean daily water temperatures
daily_maxs_condensed <- readRDS("daily_maxs_condensed.rds") #Matrix of daily maximum temperatures
daily_mins_condensed <- readRDS("daily_mins_condensed.rds") #Matrix of daily minimum temperatures


#AIR TEMPERATURE DATA
##The air temperature dataset was downloaded from the National Oceanic and Atmospheric Administration’s Climate Data Online database for the Slater Butte air sensor in Siskiyou County, CA.

airtemp_lag <- read.csv("SlaterButteAirTemp_2020_2021_lag.csv") 


#DISSOLVED OXYGEN DATA
##DO and temperature depth profiles were taken using a YSI DO200M in June 2023.
##DO was measured using HOBO DO probes for several days in each pond in July 2020. 

dp <- read.csv("DepthProfiles_All.csv") #Temperature and Dissolved Oxygen depth profiles taken in June 2023
Sen212_DO <- read.csv("Sen212_DO.csv")
Sen213_DO <- read.csv("Sen213_DO.csv")
Sen214_DO <- read.csv("Sen214_DO.csv")
Sen215_DO <- read.csv("Sen215_DO.csv")
Sen216_DO <- read.csv("Sen216_DO.csv")
Sen217_DO <- read.csv("Sen217_DO.csv")


#MISCELLANEOUS DATA 
##Miscellaneous data pulled into separate datasets for easier figure creation

daily_means <- readRDS("daily_means.RDS") #This data set is not "condensed", meaning it has each sensor time series listed individually instead of averaging all sensors in the same site. We used this dataset only for visualization.
```

#FIGURE 2 & TABLE 2: MAR MODEL 
## Transform matrices (z-score)
```{r}
z_daily_means_condensed <- zscore(daily_means_condensed)
```

##Process covariate data
###All models use a t-1 (1 day lagged) air temperature dataset
```{r}
airtemp_lag <- read.csv("SlaterButteAirTemp_2020_2021_lag.csv")

#Convert Fahrenheit to Celsius
airtemp_lag$TAVG <- fahrenheit.to.celsius(airtemp_lag$TAVG)
airtemp_lag$TMAX <- fahrenheit.to.celsius(airtemp_lag$TMAX)
airtemp_lag$TMIN <- fahrenheit.to.celsius(airtemp_lag$TMIN)

#Convert dates to appropriate format
airtemp_lag$date <- lubridate::mdy(airtemp_lag$DATE)
missing_data <- airtemp_lag[!complete.cases(airtemp_lag),] #No missing data
missing_data
airtemp_lag$day <- lubridate::floor_date(airtemp_lag$date, unit="day")
covariate_lag <- (t(airtemp_lag$TAVG))

#z score to fit with our data
z_covariate_lag <- zscore(covariate_lag)

#t-1 lag (30 June 2020 - 12 July 2021) - 1 day lag
z_covariate_t1 <- z_covariate_lag[c(16:393)]
z_covariate_t1 <- as.matrix(t(z_covariate_t1))
str(z_covariate_t1)
```

## Hypothesis 1: all states have different levels of stochastic (Q) and deterministic (C) variability 
```{r}
# convention: name modhypothesis
mod1 = list()
mod1$A = "zero" 
mod1$Z = "identity"
mod1$R = "zero" 
mod1$Q = "diagonal and unequal" 
mod1$B = "diagonal and unequal" 
mod1$U = "zero"  
mod1$C = "unequal" 
mod1$c = z_covariate_t1
mod1.fit = MARSS(z_daily_means_condensed, model=mod1)
mod1_params =MARSSparamCIs(mod1.fit)
MARSSparamCIs(mod1.fit)
saveRDS(mod1_params,"mod1_params.RDS")
```
## Hypothesis 2: all states have save levels of stochastic (Q) and deterministic (C) variability
```{r}
# convention: name modhypothesis
mod2 = list()
mod2$A = "zero" 
mod2$Z = "identity"
mod2$R = "zero" 
mod2$Q = "diagonal and equal" 
mod2$B = "diagonal and equal" 
mod2$U = "zero"  
mod2$C = "equal" 
mod2$c = z_covariate_t1
mod2.fit = MARSS(z_daily_means_condensed, model=mod2)
mod2.params =MARSSparamCIs(mod2.fit)
MARSSparamCIs(mod2.fit)
```
```{r}
# plot residuals
par(mfrow=c(5,2), mai=c(0.1,0.5,0.2,0.1), omi=c(0.5,0,0,0))
  for (j in 1:5) {
    plot.ts(residuals<-MARSSresiduals(mod2.fit, type = "tt1")$model.residuals[j, ],
            ylab = "Residual")
    abline(h = 0, lty = "dashed")
    acf(residuals,na.action = na.pass)
  }
```

## Hypothesis 3: Habitat type (Creeks vs ponds vs Klamath)
```{r}
# convention: name modhypothesis
mod3 = list()
## Modify matrices
# 1st: group time series into categories
hypothesis = c("pond","pond","pond","pond",
               "pond","pond","pond","pond",
               "pond","creek","creek","Klamath")

# 2nd: build C matrix (12 x 1)
mod3$C = matrix(hypothesis)
mod3$c = z_daily_means_condensed

# 3rd: build Q matrix (12 x 12, with "C vector" in its diagonal)
Q <-  matrix(list("pond",0,0,0,0,0,0,0,0,0,0,0,
                  0,"pond",0,0,0,0,0,0,0,0,0,0,
                  0,0,"pond",0,0,0,0,0,0,0,0,0,
                  0,0,0,"pond",0,0,0,0,0,0,0,0,
                  0,0,0,0,"pond",0,0,0,0,0,0,0,
                  0,0,0,0,0,"pond",0,0,0,0,0,0,
                  0,0,0,0,0,0,"pond",0,0,0,0,0,
                  0,0,0,0,0,0,0,"pond",0,0,0,0,
                  0,0,0,0,0,0,0,0,"pond",0,0,0,
                  0,0,0,0,0,0,0,0,0,"creek",0,0,
                  0,0,0,0,0,0,0,0,0,0,"creek",0,
                  0,0,0,0,0,0,0,0,0,0,0,"Klamath"),12,12)

# 4th: B, identical to Q
B <- Q

mod3$A = "zero" 
mod3$Z = "identity"
mod3$R = "zero" 
mod3$Q = Q 
mod3$B = Q
mod3$U = "zero"  
mod3$C = matrix(hypothesis) 
mod3$c = z_covariate_t1
mod3.fit = MARSS(z_daily_means_condensed, model=mod3)
mod3.params =MARSSparamCIs(mod3.fit)
MARSSparamCIs(mod3.fit)

```
```{r}
# plot residuals
par(mfrow=c(5,2), mai=c(0.1,0.5,0.2,0.1), omi=c(0.5,0,0,0))
  for (j in 1:5) {
    plot.ts(residuals<-MARSSresiduals(mod3.fit, type = "tt1")$model.residuals[j, ],
            ylab = "Residual")
    abline(h = 0, lty = "dashed")
    acf(residuals,na.action = na.pass)
  }
```
## Hypothesis 4: Watershed (Horse Creek vs. Seiad Creek)
```{r}
# convention: name modhypothesis
mod4 = list()
## Modify matrices
# 1st: group time series into categories
rownames(z_daily_means_condensed)
hypothesis2 = c("SC","SC","SC","SC",
               "SC","HC","HC","HC",
               "HC","SC","HC","Klamath")

# 2nd: build C matrix (12 x 1)
mod4$C = matrix(hypothesis2)
mod4$c = z_daily_means_condensed

# 3rd: build Q matrix (12 x 12, with "C vector" in its diagonal)
Q <-  matrix(list("SC",0,0,0,0,0,0,0,0,0,0,0,
                  0,"SC",0,0,0,0,0,0,0,0,0,0,
                  0,0,"SC",0,0,0,0,0,0,0,0,0,
                  0,0,0,"SC",0,0,0,0,0,0,0,0,
                  0,0,0,0,"SC",0,0,0,0,0,0,0,
                  0,0,0,0,0,"HC",0,0,0,0,0,0,
                  0,0,0,0,0,0,"HC",0,0,0,0,0,
                  0,0,0,0,0,0,0,"HC",0,0,0,0,
                  0,0,0,0,0,0,0,0,"HC",0,0,0,
                  0,0,0,0,0,0,0,0,0,"SC",0,0,
                  0,0,0,0,0,0,0,0,0,0,"HC",0,
                  0,0,0,0,0,0,0,0,0,0,0,"Klamath"),12,12)

# 4th: B, identical as Q
B <- Q

mod4$A = "zero" 
mod4$Z = "identity"
mod4$R = "zero" 
mod4$Q = Q 
mod4$B = Q
mod4$U = "zero"  
mod4$C = matrix(hypothesis2) 
mod4$c = z_covariate_t1
mod4.fit = MARSS(z_daily_means_condensed, model=mod4)
mod4.params =MARSSparamCIs(mod4.fit)
MARSSparamCIs(mod4.fit)

```
```{r}
# plot residuals
par(mfrow=c(5,2), mai=c(0.1,0.5,0.2,0.1), omi=c(0.5,0,0,0))
  for (j in 1:5) {
    plot.ts(residuals<-MARSSresiduals(mod4.fit, type = "tt1")$model.residuals[j, ],
            ylab = "Residual")
    abline(h = 0, lty = "dashed")
    acf(residuals,na.action = na.pass)
  }
```

##AICc 
```{r}
data.frame(Model=c("mod1", "mod2", "mod3", "mod4"),
           AICc=round(c(mod1.fit$AICc,
                        mod2.fit$AICc,
                        mod3.fit$AICc,
                        mod4.fit$AICc),1))
```



#FIGURE 3c: COVARIATE EFFECTS
##Air temperature effects (using parameters from mod1, the best supported MAR model result)
```{r}
mod1_params <- readRDS("mod1_params.RDS")
mod1_df <- broom::tidy(mod1_params)
mod1_df_clip <- mod1_df[c(37:48),]
mod1_df_clip$name <- c("Alexander","Stender","Durazo","LowerSeiad","May","FishGulch","Goodman","UpperLaw","LowerLaw","SeiadCreek","HorseCreek","KlamathRiver")

mod1_df_clip$name <- factor(mod1_df_clip$name, levels = c("Alexander","Stender","Durazo","LowerSeiad","May","SeiadCreek","FishGulch","Goodman","UpperLaw","LowerLaw","HorseCreek","KlamathRiver"))

sc <- subset(mod1_df_clip, name == "SeiadCreek")
hc <- subset(mod1_df_clip, name == "HorseCreek")
kr <- subset(mod1_df_clip, name == "KlamathRiver")
```

```{r}
ggplot()+
  geom_pointrange(data = mod1_df_clip, aes(x = name, y = estimate, ymin = conf.low, ymax = conf.up, color = "Ponds")) +
  geom_pointrange(data = sc, aes(x = name, y = estimate, ymin = conf.low, ymax = conf.up, color = "Creeks")) +
  geom_pointrange(data = hc, aes(x = name, y = estimate, ymin = conf.low, ymax = conf.up, color = "Creeks")) +
  geom_pointrange(data = kr, aes(x = name, y = estimate, ymin = conf.low, ymax = conf.up, color = "River")) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(x = "Sites",
       y = "Air Temperature Effects") +
  ggtitle("(c) Air Temperature Effects") +
  theme_classic()+
  theme(text=element_text(size=16),axis.text.x=element_text(angle = 45, hjust = 1), legend.position =c(.15,.9))+
  scale_colour_manual("", values = c("Ponds"="#88a0dc", "Creeks"="#ed968c", "River" = "#ab3329"))+
  scale_y_continuous("Air temperature effects \n (ΔC_water/ΔC_air)")
```


#FIGURE 4: SEASONAL THERMAL BUFFER ANALYSIS 

##Summer 
###Data wrangling
```{r}
#Read in data
daily_maxs_condensed <- readRDS('daily_maxs_condensed.RDS')
daily_maxs_condensed <- as.data.frame(t(daily_maxs_condensed))
daily_maxs_condensed <- daily_maxs_condensed %>% mutate_all(~ifelse(is.nan(.), NA, .))

#Create "day" sequence 
day <- seq(mdy('7/1/2020'),mdy('7/13/2021'),by = "day") 
day <- as.data.frame(day) #convert "day" to data frame

#Attach day to data frame
daily_maxs_condensed <- cbind(daily_maxs_condensed,day)

#Format data long
daily_max_long <- gather(daily_maxs_condensed, site, value, -day)
data_summer <- daily_max_long %>%filter(day>'2020-07-15'& day < '2020-09-15')

#Make a column for habitat
data_summer['habitat'] <- NA
data_summer$habitat <- with(data_summer, ifelse(site == "SC" | site == "HC",as.character("creek"), as.character("pond")))

#Calculate average daily maxs
SC_max <- data_summer[data_summer$site %in% "SC",]
mean(SC_max$value,na.rm=T)

HC_max <- data_summer[data_summer$site %in% "HC",]
mean(HC_max$value,na.rm=T)

SCponds_max <- data_summer[data_summer$site %in% c("AP","SP","Durazo","May","LS"),]
mean(SCponds_max$value,na.rm=T)

HCponds_max <- data_summer[data_summer$site %in% c("FG","GP","UL","LL"),]
mean(HCponds_max$value,na.rm=T)
```

###Seiad Creek 
####ANOVA 
```{r}
data_summer_SC<- subset(data_summer, site %in% c("AP","SP","Durazo","LS","May","SC"))
data_summer_SC$site<-as.factor(data_summer_SC$site)
#write.csv(data_summer_SC,"data_summer_SC.csv")

#Check variance
ggplot(data_summer_SC, aes(x=site, y=value)) + 
  geom_boxplot() + theme_classic()

#Check residuals.
leveneTest(value ~ site, data = data_summer_SC) #Levene's Test fails
anova_SC <- aov(value~site, data = data_summer_SC) #Run one way anova
anova_SC_residuals <- residuals(object = anova_SC ) #Pull out residuals
ggplot(anova_SC, aes(x = .fitted, y = .resid)) +
  geom_point() + theme_classic()

#Check normality
shapiro.test(x = anova_SC_residuals) 

#Note: Also tried log, log10, and square root transformations on this data and results and assumption checks are similar to untransformed data. We ultimately used untransformed data to make interpretation easier. 

#Anova (untransformed)
anova_SC <- aov(value~site, data = data_summer_SC) #run one way anova
summary(anova_SC) ##Significance is very high. 

#To be safe, let's check a non-parametric test to see if we get a similar result.
kruskal.test(value ~ site, data = data_summer_SC) ##Also  significant. 
 
```

####PostHoc
```{r}
#Posthoc analysis
anova_SC <- aov(value ~ site, data = data_summer_SC)
summary(anova_SC)##Note the degrees of freedom. 
tukey<-TukeyHSD(anova_SC)
print(tukey)

##To help label
groups <- multcompLetters4(anova_SC, tukey)
print(groups)
```
####Boxplot
```{r}
#Boxplot
scs <- subset(data_summer, site == "SC")
seiad_summer <- subset(data_summer, site %in% c("AP","SP","Durazo","LS","May","SC"))

b1 <- ggplot()+
  geom_boxplot(data = seiad_summer, aes(x = site, value, col = day))+
  geom_boxplot(data = scs, aes(x = site, value, col = day))+
  labs(title = "(a) Seiad, 15 July - 15 September")+
  theme_classic()+
  theme(text=element_text(size=16), axis.title.x=element_blank())+
  scale_x_discrete(name ="Site", 
                   limits = c("AP","SP","Durazo","LS","May","SC"),
                    labels=c("AP" = "Alexander","SP"= "Stender","Durazo"=
                               "Durazo","LS" = "LowerSeiad","May"="May","SC" = "SeiadCreek"))+
  scale_y_continuous(name="Daily Maximum Temp (C)",limits=c(12.5, 22.5))

b1
```
###Horse Creek

####ANOVA 
```{r}
#ANOVA
data_summer_HC <- subset(data_summer, site %in% c("FG","UL","LL","GP","HC"))
data_summer_HC$site<-as.factor(data_summer_HC$site)

#Check variance
ggplot(data_summer_HC, aes(x=site, y=value)) + 
  geom_boxplot() + theme_classic()

#Check residuals
leveneTest(value ~ site, data = data_summer_HC) #Levene's Test fails
anova_HC <- aov(value ~ site, data = data_summer_HC) #Run one way anova
anova_HC_residuals <- residuals(object = anova_HC ) #Pull out residuals
ggplot(anova_HC, aes(x = .fitted, y = .resid)) +
  geom_point() + theme_classic()

#Check normality
shapiro.test(x = anova_HC_residuals) #check for normality

#Note: Also tried log, log10, and square root transformations on this data and results and assumption checks are similar to untransformed data. We ultimately used untransformed data to make interpretation easier. 

#Anova (untransformed)
anova_HC <- aov(value ~ site, data = data_summer_HC) #run one way anova
summary(anova_HC) ##Significance is very high

#To be safe, let's check a non-parametric test to see if we get a similar result.
kruskal.test(value ~ site, data = data_summer_HC) ##Also  significant. 
```

####PostHoc
```{r}
#Posthoc analysis
anova_HC <- aov(value ~ site, data = data_summer_HC)
summary(anova_HC)##Note the degrees of freedom. 
tukey<-TukeyHSD(anova_HC)
print(tukey)

##To help label
groups <- multcompLetters4(anova_HC, tukey)
print(groups)
```
####Boxplot
```{r}
#Boxplot
hcs <- subset(data_summer, site == "HC")
horse_summer <- subset(data_summer, site %in% c("FG","UL","LL","GP","HC"))

b2 <- ggplot()+
  geom_boxplot(data = horse_summer, aes(x = site, value, col = day))+
  geom_boxplot(data = hcs, aes(x = site, value, col = day))+
  labs(title = "(b) Horse, 15 July - 15 September")+
  theme_classic()+
  theme(text=element_text(size=16), axis.title.x=element_blank())+
  scale_x_discrete(name ="Site", 
                   limits = c("FG","UL","LL","GP","HC"),
                    labels=c("FG" = "FishGulch","UL"= "UpperLaw","LL"=
                               "LowerLaw","GP" = "Goodman","HC"="HorseCreek"))+
  scale_y_continuous(name="Daily Maximum Temp (C)",limits=c(12.5, 22.5))
b2
```
##Winter 
###Data wrangling
```{r}
#Read in data
daily_mins_condensed <- readRDS('daily_mins_condensed.RDS')
daily_mins_condensed <- as.data.frame(t(daily_mins_condensed))
daily_mins_condensed <- daily_mins_condensed %>% mutate_all(~ifelse(is.nan(.), NA, .))

#Create "day" sequence 
day <- seq(mdy('7/1/2020'),mdy('7/13/2021'),by = "day") 
day <- as.data.frame(day) #convert "day" to data frame

#Attach day to data frame
daily_mins_condensed <- cbind(daily_mins_condensed,day)

#Format data long
daily_min_long <- gather(daily_mins_condensed, site, value, -day)
data_winter <- daily_min_long %>%filter(day>'2020-12-15'& day < '2021-02-15')
```

###Seiad Creek 
####ANOVA
```{r}
#ANOVA
data_winter_SC<- subset(data_winter, site %in% c("AP","SP","Durazo","LS","May","SC"))
data_winter_SC$site<-as.factor(data_winter_SC$site)

#Check variance
ggplot(data_winter_SC, aes(x=site, y=value)) + 
  geom_boxplot() + theme_classic()

#Check residuals.
leveneTest(value ~ site, data = data_winter_SC) #Levene's Test 
anova_SC2 <- aov(value ~ site, data = data_winter_SC) #run one way anova
anova_SC2_residuals <- residuals(object = anova_SC2 ) #Pull out residuals
ggplot(anova_SC2, aes(x = .fitted, y = .resid)) +
  geom_point() + theme_classic()
#Residuals look ok. 

#Check normality
shapiro.test(x = anova_SC2_residuals) #check for normality. Seems ok. 

#Note: Also tried log, log10, and square root transformations on this data and results and assumption checks are similar to untransformed data. We ultimately used untransformed data to make interpretation easier. 

#Anova (untransformed)
anova_SC2 <- aov(value ~ site, data = data_winter_SC) #run one way anova
summary(anova_SC2) ##Significance is very high

#To be safe, let's check a non-parametric test to see if we get a similar result.
kruskal.test(value ~ site, data = data_winter_SC) ##Also  significant. 
```

####PostHoc
```{r}
#Posthoc analysis
anova_SC2 <- aov(value ~ site, data = data_winter_SC)
summary(anova_SC2)##Note the degrees of freedom. 
tukey<-TukeyHSD(anova_SC2)
print(tukey)

##To help label
groups <- multcompLetters4(anova_SC2, tukey)
print(groups)
```
####Boxplot
```{r}
#Boxplot
scw <- subset(data_winter, site == "SC")
seiad_winter <- subset(data_winter, site %in% c("AP","SP","Durazo","LS","May","SC"))


b3 <- ggplot()+
  geom_boxplot(data = seiad_winter, aes(x = site, value, col = day))+
 geom_boxplot(data = scw, aes(x = site, value, col = day))+
  labs(title = "(c) Seiad, 15 December - 15 February")+
  theme_classic()+
  theme(text=element_text(size=16))+
  scale_x_discrete(name ="Site", 
                   limits = c("AP","SP","Durazo","LS","May","SC"),
                    labels=c("AP" = "Alexander","SP"= "Stender","Durazo"=
                               "Durazo","LS" = "LowerSeiad","May"="May","SC" = "SeiadCreek"))+
  scale_y_continuous(name="Daily Minimum Temp (C)",limits=c(4, 12))
b3
```

###Horse Creek
####ANOVA
```{r}
#ANOVA
data_winter_HC <- subset(data_winter, site %in% c("FG","UL","LL","GP","HC"))
data_winter_HC$site<-as.factor(data_winter_HC$site)

#Check variance
ggplot(data_winter_HC, aes(x=site, y=value)) + 
  geom_boxplot() + theme_classic()

#Check residuals.
leveneTest(value ~ site, data = data_winter_HC) #Levene's Test 
anova_HC2 <- aov(value ~ site, data = data_winter_HC) #run one way anova
anova_HC2_residuals <- residuals(object = anova_HC2 ) #Pull out residuals
ggplot(anova_HC2, aes(x = .fitted, y = .resid)) +
  geom_point() + theme_classic()

#Check normality
shapiro.test(x = anova_HC2_residuals) #check for normality

#Note: Also tried log, log10, and square root transformations on this data and results and assumption checks are similar to untransformed data. We ultimately used untransformed data to make interpretation easier. 

#Anova (untransformed)
anova_HC2 <- aov(value ~ site, data = data_winter_HC) #run one way anova
summary(anova_HC2) ##Significance is very high. 

#To be safe, let's check a non-parametric test to see if we get a similar result.
kruskal.test(value ~ site, data = data_winter_HC) ##Also  significant. 

```

####PostHoc
```{r}
#Posthoc analysis
anova_HC2 <- aov(value ~ site, data = data_winter_HC)
summary(anova_HC2)##Note the degrees of freedom. 
tukey<-TukeyHSD(anova_HC2)
print(tukey)

##To help label
groups <- multcompLetters4(anova_HC2, tukey)
print(groups)
```

####Boxplot
```{r}
#Boxplot
hcw <- subset(data_winter, site == "HC")
horse_winter <- subset(data_winter, site %in% c("FG","UL","LL","GP","HC"))
  
b4 <- ggplot()+
  geom_boxplot(data = horse_winter, aes(x = site, value, col = day))+
  geom_boxplot(data = hcw, aes(x = site, value, col = day))+
  labs(title = "(d) Horse, 15 December - 15 February")+
  theme_classic()+
  theme(text=element_text(size=16))+
  scale_x_discrete(name ="Site", 
                   limits = c("FG","UL","LL","GP","HC"),
                    labels=c("FG" = "FishGulch","UL"= "UpperLaw","LL"=
                               "LowerLaw","GP" = "Goodman","HC"="HorseCreek"))+
  scale_y_continuous(name="Daily Minimum Temp (C)",limits=c(4, 12))
b4
```

##Boxplot Figure 
```{r}
(b1 + b2) / (b3 + b4)
```


#FIGURE S1: TEMPERATURE TIME SERIES OF ALL SENSORS
```{r}
#Alexander Pond (AP)
colorAP <- c("AP1" = "#88a0dc")
AP <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = AP1, color = "AP1"), size = 1) +
  labs(title = "Alexander Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorAP, labels = c("AP1"))+ 
  theme(text=element_text(size=16), legend.position="none")

#Stender Pond (SP)
colorSP <- c("SP1" = "#88a0dc", "SP2" = "#ed968c")
SP <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = SP1, color = "SP1"), size = 1) +
  geom_line(aes(x = day, y = SP2, color = "SP2"), size = 1)+
  labs(title = "Stender Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorSP, labels = c("SP1","SP2"))+ 
  theme(text=element_text(size=16), legend.position="none")+
  geom_text(x=200, y=20, label="r = 0.999, p < 0.001", size = 5)

#Durazo Pond (Durazo)
colorD <- c("Durazo" = "#88a0dc")
D <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = Durazo, color = "Durazo"), size = 1) +
  labs(title = "Durazo Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorD, labels = c("SP1","SP2"))+ 
  theme(text=element_text(size=16), legend.position="none")

#Lower Seiad Pond (LS)
colorLS <- c("LS" = "#88a0dc")
LS <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = LS, color = "LS"), size = 1) +
  labs(title = "Lower Seiad Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorLS, labels = c("LS"))+ 
  theme(text=element_text(size=16), legend.position="none")

#May Pond (May)
colorMay <- c("May" = "#88a0dc")
May <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = May, color = "May"), size = 1) +
  labs(title = "May Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorMay, labels = c("May"))+ 
  theme(text=element_text(size=16), legend.position="none")

#Fish Gulch Pond (FG)
colorFG <- c("FG" = "#88a0dc")
FG <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = FG3, color = "FG"), size = 1) +
  labs(title = "Fish Gulch Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorFG, labels = c("FG"))+ 
  theme(text=element_text(size=16), legend.position="none")

#Goodman Pond (GP)
colorGP <- c("GP2" = "#88a0dc", "GP3" = "#ed968c")
GP <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = GP2, color = "GP2"), size = 1) +
  geom_line(aes(x = day, y = GP3, color = "GP3"), size = 1) +
  labs(title = "Goodman Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorGP, labels = c("GP2","GP3"))+ 
  theme(text=element_text(size=16), legend.position="none")+
  geom_text(x=200, y=20, label="r = 0.979, p < 0.001", size = 5)

#Upper Lawrence Pond (UL)
colorUL <- c("ULout" = "#88a0dc", "UL3" = "#ed968c")
UL <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = ULout, color = "ULout"), size = 1) +
  geom_line(aes(x = day, y = UL3, color = "UL3"), size = 1) +
  labs(title = "Upper Lawrence Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorUL, labels = c("ULout","UL3"))+ 
  theme(text=element_text(size=16), legend.position="none")+
  geom_text(x=200, y=20, label="r = 0.991, p < 0.001", size = 5)

#Lower Lawrence Pond (LL)
colorLL <- c("LL1" = "#88a0dc", "LL2" = "#ed968c", "LL3" = "#f9d14a")
LL <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = LL1, color = "LL1"), size = 1) +
  geom_line(aes(x = day, y = LL2, color = "LL2"), size = 1)+
  geom_line(aes(x = day, y = LL3, color = "LL3"), size = 1)+
  labs(title = "Lower Lawrence Pond", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorLL, labels = c("LL1","LL2","LL3"))+ 
  theme(text=element_text(size=16), legend.position="none")+
  geom_text(x=200, y=20, label="r = 0.988 p < 0.001 \nr = 0.981, p < 0.001\n r = 0.997, p < 0.001", size = 5)

#Seiad Creek (SC)
colorSC <- c("LSck" = "#88a0dc", "MayCk"="#ed968c")
SC <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = LSck, color = "LSck"), size = 1)+
  geom_line(aes(x = day, y = MayCk, color = "MayCk"), size = 1)+
  labs(title = "Seiad Creek", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorSC, labels = c("LSck","MayCk"))+ 
  theme(text=element_text(size=16), legend.position="none")+
  geom_text(x=200, y=20, label="r = 0.999, p < 0.001", size = 5)

#Horse Creek (HC)
colorHC <- c("FGck" = "#88a0dc", "ULck" = "#ed968c")
HC <- daily_means %>% rowid_to_column(var = "day") %>% ggplot()+
  geom_line(aes(x = day, y = FGck, color = "FGck"), size = 1) +
  geom_line(aes(x = day, y = ULck, color = "ULck"), size = 1)+
  labs(title = "Horse Creek", x = "Day", y = "Temperature (degrees C)", color = "Legend")+
  scale_y_continuous(name="Daily Mean Temp (C)",limits=c(0, 25))+
  theme_classic()+
  scale_color_manual(values = colorHC, labels = c("FGck","ULck"))+ 
  theme(text=element_text(size=16), legend.position="none")+
  geom_text(x=200, y=20, label="r = 0.999, p < 0.001", size = 5)

empty <- daily_means %>% rowid_to_column(var = "day") %>%
  ggplot()+
  geom_blank(aes(x = day, y = ULck, color =))+
  theme(panel.background = element_rect(fill = 'white', colour = 'white')) +
  theme_void()

#Plots
(AP + SP + D) / (LS + May + SC)

(FG + GP + UL) / (LL + HC + empty)
```


#TABLE S1: CORELLATION ANALYSIS OF SENSORS IN SAME PONDS
##Correlation, Mean, and Standard Deviation between multiple temperature time series in a pond (only for ponds/creeks with more than 1 sensor)
```{r}
#Stender Pond (SP) 
corSP <- cor.test(daily_means$SP1, daily_means$SP2, use = "na.or.complete", method = "pearson")
diffSP <- daily_means$SP1 - daily_means$SP2
meanSP <- mean(diffSP,na.rm=T) 
sdSP <- sd(diffSP,na.rm=T) 


#Goodman Pond (GP) 
cor.test(daily_means$GP2, daily_means$GP3, use = "na.or.complete", method = "pearson")
diffGP <- daily_means$GP3 - daily_means$GP2
meanGP <- mean(diffGP,na.rm=T) 
sdGP <- sd(diffGP,na.rm=T) 

cor.test(daily_means$GP1, daily_means$GP2, use = "na.or.complete", method = "pearson")
diffGPa <- daily_means$GP2 - daily_means$GP1
meanGPa <- mean(diffGPa,na.rm=T) 
sdGPa <- sd(diffGP,na.rm=T) 


#Upper Lawrence Pond (UL)
cor.test(daily_means$ULout, daily_means$UL3, use = "na.or.complete", method = "pearson")
diffUL <-daily_means$ULout- daily_means$UL3
mean(diffUL,na.rm=T) 
sd(diffUL,na.rm=T) 


#Lower Lawrence Pond (LL)
cor.test(daily_means$LL1, daily_means$LL2, use = "na.or.complete", method = "pearson")
diffLL <-daily_means$LL1- daily_means$LL2
mean(diffLL,na.rm=T) 
sd(diffLL,na.rm=T) 

cor.test(daily_means$LL1, daily_means$LL3, use = "na.or.complete", method = "pearson")
diffLL <-daily_means$LL1- daily_means$LL3
mean(diffLL,na.rm=T) 
sd(diffLL,na.rm=T) 

cor.test(daily_means$LL2, daily_means$LL3, use = "na.or.complete", method = "pearson")
diffLL <-daily_means$LL2- daily_means$LL3
mean(diffLL,na.rm=T) 
sd(diffLL,na.rm=T) 


#Seiad Creek (SC)
cor.test(daily_means$LSck, daily_means$MayCk, use = "na.or.complete", method = "pearson")
diffSC <-daily_means$LSck- daily_means$MayCk
mean(diffSC,na.rm=T) 
sd(diffSC,na.rm=T) 


#Horse Creek (HC)
cor.test(daily_means$FGck, daily_means$ULck, use = "na.or.complete", method = "pearson")
diffHC <-daily_means$FGck- daily_means$ULck
mean(diffHC,na.rm=T) 
sd(diffHC,na.rm=T) 
```

#FIGURE S2: DISSOLVED OXYGEN AND TEMPERATURE DEPTH PROFILES
##Data Wrangling
```{r}
dp <- read.csv("DepthProfiles_All.csv")
```
###Fish Gulch
```{r}
mycolors <- met.brewer(name="Archambault",n=7,type="discrete")
mycolors[5]
dp_FG <- dp[dp$site %in% c("FishGulch"),]
dp_FG_1 <- dp_FG[dp_FG$profile %in% 1,]
dp_FG_2 <- dp_FG[dp_FG$profile %in% 2,]

do_FG <- ggplot()+
  geom_line(data = dp_FG_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_FG_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_FG <- ggplot()+
  geom_line(data = dp_FG_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_FG_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

FG_plot <- (do_FG + temp_FG) + plot_annotation(title = "Fish Gulch", theme = theme(plot.title = element_text(size = 16)))
FG_plot
```

###Goodman
```{r}
dp_GP <- dp[dp$site %in% c("Goodman"),]

do_GP <- ggplot()+
  geom_line(data = dp_GP, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_GP <- ggplot()+
  geom_line(data = dp_GP, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

GP_plot <- (do_GP + temp_GP) + plot_annotation(
  title = "Goodman", theme = theme(plot.title = element_text(size = 16)))
GP_plot
```

###Upper Lawrence 1
```{r}
dp_UL1 <- dp[dp$site %in% c("UpperLawrence1"),]

do_UL1 <- ggplot()+
  geom_line(data = dp_UL1, aes(x = depth_cm, y = do_mgL),color ="#f9d14a", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_UL1 <- ggplot()+
  geom_line(data = dp_UL1, aes(x = depth_cm, y = temp_c),color ="#f9d14a", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

UL1_plot <-print((do_UL1 + temp_UL1) + plot_annotation(
  title = "Upper Lawrence 1", theme = theme(plot.title = element_text(size = 16))))
```
###Upper Lawrence 2
```{r}
dp_UL2 <- dp[dp$site %in% c("UpperLawrence2"),]

do_UL2 <- ggplot()+
  geom_line(data = dp_UL2, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_UL2 <- ggplot()+
  geom_line(data = dp_UL2, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

UL2_plot <-(do_UL2 + temp_UL2) + plot_annotation(
  title = "Upper Lawrence 2", theme = theme(plot.title = element_text(size = 16)))
```
###Upper Lawrence 3
```{r}
dp_UL3 <- dp[dp$site %in% c("UpperLawrence3"),]
dp_UL3_1 <- dp_UL3[dp_UL3$profile %in% 1,]
dp_UL3_2 <- dp_UL3[dp_UL3$profile %in% 2,]

do_UL3 <- ggplot()+
  geom_line(data = dp_UL3_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_UL3_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  geom_line(data = dp_UL1, aes(x = depth_cm, y = do_mgL),color ="#f9d14a", size = 1) +
  geom_line(data = dp_UL2, aes(x = depth_cm, y = do_mgL),color ="#e78429", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_UL3 <- ggplot()+
  geom_line(data = dp_UL3_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_UL3_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  geom_line(data = dp_UL1, aes(x = depth_cm, y = temp_c),color ="#f9d14a", size = 1)+
  geom_line(data = dp_UL2, aes(x = depth_cm, y = temp_c),color ="#e78429", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()
UL3_plot <-(do_UL3 + temp_UL3) + plot_annotation(
  title = "Upper Lawrence", theme = theme(plot.title = element_text(size = 16)))
```

###Lower Lawrence
```{r}
dp_LL <- dp[dp$site %in% c("LowerLawrence"),]
dp_LL_1 <- dp_LL[dp_LL$profile %in% 1,]
dp_LL_2 <- dp_LL[dp_LL$profile %in% 2,]

do_LL <- ggplot()+
  geom_line(data = dp_LL_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_LL_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_LL <- ggplot()+
  geom_line(data = dp_LL_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_LL_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

LL_plot <-(do_LL + temp_LL) + plot_annotation(
  title = "Lower Lawrence", theme = theme(plot.title = element_text(size = 16)))
```

###Alexander
```{r}
dp_AP <- dp[dp$site %in% c("Alexander"),]
dp_AP_1 <- dp_AP[dp_AP$profile %in% 1,]
dp_AP_2 <- dp_AP[dp_AP$profile %in% 2,]

do_AP <- ggplot()+
  geom_line(data = dp_AP_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_AP_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_AP <- ggplot()+
  geom_line(data = dp_AP_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_AP_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

AP_plot <-(do_AP + temp_AP) + plot_annotation(
  title = "Alexander", theme = theme(plot.title = element_text(size = 16)))
```

###Stender
```{r}
dp_SP <- dp[dp$site %in% c("Stender"),]
dp_SP_1 <- dp_SP[dp_SP$profile %in% 1,]
dp_SP_2 <- dp_SP[dp_SP$profile %in% 2,]

do_SP <- ggplot()+
  geom_line(data = dp_SP_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_SP_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_SP <- ggplot()+
  geom_line(data = dp_SP_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_SP_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

SP_plot <-(do_SP + temp_SP) + plot_annotation(
  title = "Stender", theme = theme(plot.title = element_text(size = 16)))
```
###Durazo
```{r}
dp_DP <- dp[dp$site %in% c("Durazo"),]
dp_DP_1 <- dp_DP[dp_DP$profile %in% 1,]
dp_DP_2 <- dp_DP[dp_DP$profile %in% 2,]

do_DP <- ggplot()+
  geom_line(data = dp_DP_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_DP_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_DP <- ggplot()+
  geom_line(data = dp_DP_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_DP_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

DP_plot <-(do_DP + temp_DP) + plot_annotation(
  title = "Durazo", theme = theme(plot.title = element_text(size = 16)))
```
###May
```{r}
dp_MP <- dp[dp$site %in% c("May"),]
dp_MP_1 <- dp_MP[dp_MP$profile %in% 1,]
dp_MP_2 <- dp_MP[dp_MP$profile %in% 2,]

do_MP <- ggplot()+
  geom_line(data = dp_MP_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_MP_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_MP <- ggplot()+
  geom_line(data = dp_MP_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_MP_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

MP_plot <-(do_MP + temp_MP) + plot_annotation(
  title = "May", theme = theme(plot.title = element_text(size = 16)))
```

###Lower Seiad
```{r}
dp_LS <- dp[dp$site %in% c("LowerSeiad"),]
dp_LS_1 <- dp_LS[dp_LS$profile %in% 1,]
dp_LS_2 <- dp_LS[dp_LS$profile %in% 2,]

do_LS <- ggplot()+
  geom_line(data = dp_LS_1, aes(x = depth_cm, y = do_mgL),color ="#ab3329", size = 1) +
  geom_line(data = dp_LS_2, aes(x = depth_cm, y = do_mgL),color ="#381a61", size = 1) +
  labs(y = "Dissolved Oxygen (mg/L)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
    #ylim = c(0,11.5))+
  theme_classic()

temp_LS <- ggplot()+
  geom_line(data = dp_LS_1, aes(x = depth_cm, y = temp_c),color ="#ab3329", size = 1)+
  geom_line(data = dp_LS_2, aes(x = depth_cm, y = temp_c),color ="#381a61", size = 1)+
  labs(y = "Temperature (C)", x = "Depth from surface (cm)")+
  #reverse depth so it starts at zero
  scale_x_reverse()+
  scale_y_reverse()+
  scale_y_continuous(position="right")+
  coord_flip()+
  theme_classic()

LS_plot <-(do_LS + temp_LS) + plot_annotation(
  title = "Lower Seiad", theme = theme(plot.title = element_text(size = 16)))
```

# FIGURE S3: DISSOLVED OXYGEN TIME SERIES
##Alexander
```{r}
### Alexander SN 214, 15:40 on 10 July to 14:17 on 16 July
#### Total Depth (m): 0.66			Sensor Depth (from btm, m): 0.58	

AP_DO <- Sen214_DO
AP_DO$date <- lubridate::mdy_hm(AP_DO$date_time)
head(AP_DO, n = 50) 
tail(AP_DO, n = 100) 

#search for start date + 1 time step (5 min)
startAP <- which(AP_DO$date == "2020-07-10 15:45:00 UTC", arr.ind = TRUE)
endAP <- which(AP_DO$date == "2020-07-16 14:10:00 UTC", arr.ind = TRUE)

AP_DO <- AP_DO[c(startAP:endAP),] 
str(AP_DO) 
AP_DO <- AP_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- AP_DO[!complete.cases(AP_DO),] 
missing_data
```

```{r}
ggplot()+
  geom_line(data = AP_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Alexander Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Stender
```{r}
### Stender SN 217, 15:00 on 11 July to 14:43 on 16 July 
#### Total Depth (m): 0.82			Sensor Depth (from btm, m): 0.5	

SP_DO <- Sen217_DO
SP_DO$date <- lubridate::mdy_hm(SP_DO$date_time)
head(SP_DO, n = 50) 
tail(SP_DO, n = 100) 

#search for start date + 1 time step (5 min)
startSP <- which(SP_DO$date == "2020-07-11 15:05:00 UTC", arr.ind = TRUE)
#Chop hours off the end
endSP <- which(SP_DO$date == "2020-07-16 06:35:00 UTC", arr.ind = TRUE)

SP_DO <- SP_DO[c(startSP:endSP),] 
str(SP_DO) 
SP_DO <- SP_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- SP_DO[!complete.cases(SP_DO),] 
missing_data
```

```{r}
ggplot()+
  geom_line(data = SP_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Stender Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Durazo
```{r}
### Durazo SN 212, 11:02 on 17 July to 12:20 on 23 July
#### Total Depth (m): 0.75			Sensor Depth (from btm, m): 0.5	

Durazo_DO <- Sen212_DO
Durazo_DO$date <- lubridate::mdy_hm(Durazo_DO$date_time)
head(Durazo_DO, n = 50) 
tail(Durazo_DO, n = 100) 

#search for start date + 1 time step (5 min)
startDurazo <- which(Durazo_DO$date == "2020-07-17 11:10:00 UTC", arr.ind = TRUE)
endDurazo <- which(Durazo_DO$date == "2020-07-23 02:15:00 UTC", arr.ind = TRUE)

Durazo_DO <- Durazo_DO[c(startDurazo:endDurazo),] 
str(Durazo_DO) 
Durazo_DO <- Durazo_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- Durazo_DO[!complete.cases(Durazo_DO),] 
missing_data
```

```{r}
ggplot()+
  geom_line(data = Durazo_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Durazo Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Lower Seiad
```{r}
### Lower Seiad SN 216, 11:32 on 17 July to 12:32 on 23 July 
#### Total Depth (m): 1.86			Sensor Depth (from btm, m): 0.55

LS_DO <- Sen216_DO
LS_DO$date <- lubridate::mdy_hm(LS_DO$date_time)
head(LS_DO, n = 50) 
tail(LS_DO, n = 100) 

#search for start date + 1 time step (5 min)
startLS <- which(LS_DO$date == "2020-07-17 11:40:00 UTC", arr.ind = TRUE)
endLS <- which(LS_DO$date == "2020-07-23 12:25:00 UTC", arr.ind = TRUE)

LS_DO <- LS_DO[c(startLS:endLS),] 
str(LS_DO) 
LS_DO <- LS_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- LS_DO[!complete.cases(LS_DO),] 
missing_data
```

```{r}
ggplot()+
  geom_line(data = LS_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Lower Seiad Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##May
```{r}
### May SN 213, 11:50 on 17 July to 12:42 on 23 July 
#### Total Depth (m): 1.1			Sensor Depth (from btm, m): 0.9	

May_DO <- Sen213_DO
May_DO$date <- lubridate::mdy_hm(May_DO$date_time)
head(May_DO, n = 50) 
tail(May_DO, n = 100) 

#search for start date + 1 time step (5 min)
startMay <- which(May_DO$date == "2020-07-17 11:55:00 UTC", arr.ind = TRUE)
endMay <- which(May_DO$date == "2020-07-23 12:50:00 UTC", arr.ind = TRUE)

May_DO <- May_DO[c(startMay:endMay),] 
str(May_DO) 
May_DO <- May_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- May_DO[!complete.cases(May_DO),] 
missing_data
```
```{r}
ggplot()+
  geom_line(data = May_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "May Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Fish Gulch
```{r}
### FishGulch SN 215, 12:46 on 10 July to 10:53 on 16 July
#### Total Depth (m): 0.51			Sensor Depth (from btm, m): 0.45

FG_DO <- Sen215_DO
FG_DO$date <- lubridate::mdy_hm(FG_DO$date_time)
head(FG_DO, n = 50) 
tail(FG_DO, n = 100) 

#search for start date + 1 time step (5 min)
startFG <- which(FG_DO$date == "2020-07-10 12:50:00 UTC", arr.ind = TRUE)
endFG <- which(FG_DO$date == "2020-07-16 10:45:00 UTC", arr.ind = TRUE)

FG_DO <- FG_DO[c(startFG:endFG),] 
str(FG_DO) 
FG_DO <- FG_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- FG_DO[!complete.cases(FG_DO),] 
missing_data
```
```{r}
ggplot()+
  geom_line(data = FG_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Fish Gulch Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Goodman
```{r}
###Goodman SN 212, 10:47 on 9 July to 12:35 on 16 July
#### Total Depth (m): 0.57			Sensor Depth (from btm, m): 0.40

GP_DO <- Sen212_DO
GP_DO$date <- lubridate::mdy_hm(GP_DO$date_time)
head(GP_DO, n = 50) 
tail(GP_DO, n = 100) 

#search for start date + 1 time step (5 min)
startGP <- which(GP_DO$date == "2020-07-09 10:55:00 UTC", arr.ind = TRUE)
#Cut off a few hours on the backend
endGP <- which(GP_DO$date == "2020-07-16 04:40:00 UTC", arr.ind = TRUE)

GP_DO <- GP_DO[c(startGP:endGP),] 
str(GP_DO) 
GP_DO <- GP_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- GP_DO[!complete.cases(GP_DO),] 
missing_data
```
```{r}
ggplot()+
  geom_line(data = GP_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Goodman Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Upper Lawrence
```{r}
### Upper Law SN 216, 15:24 on 7 July to 11:45 on 16 July
#### Total Depth (m): 0.22			Sensor Depth (from btm, m): 0.15

UL_DO <- Sen216_DO
UL_DO$date <- lubridate::mdy_hm(UL_DO$date_time)
head(UL_DO, n = 50) 
tail(UL_DO, n = 100) 

#search for start date + 1 time step (5 min)
startUL <- which(UL_DO$date == "2020-07-07 15:30:00 UTC", arr.ind = TRUE)
endUL <- which(UL_DO$date == "2020-07-16 11:40:00 UTC", arr.ind = TRUE)

UL_DO <- UL_DO[c(startUL:endUL),] 
str(UL_DO) 
UL_DO <- UL_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- UL_DO[!complete.cases(UL_DO),] 
missing_data

```


```{r}
ggplot()+
  geom_line(data = UL_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Upper Lawrence Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Lower Lawrence
```{r}
### Lower Law SN 213, 15:45 on 9 July to 12:02 on 16 July 
#### Total Depth (m): 0.33			Sensor Depth (from btm, m): 0.20	

LL_DO <- Sen213_DO
LL_DO$date <- lubridate::mdy_hm(LL_DO$date_time)
head(LL_DO, n = 50) 
tail(LL_DO, n = 100) 

#search for start date + 1 time step (5 min)
startLL <- which(LL_DO$date == "2020-07-09 15:50:00 UTC", arr.ind = TRUE)
#cut off a few hours on the back end
endLL <- which(LL_DO$date == "2020-07-16 03:55:00 UTC", arr.ind = TRUE)

LL_DO <- LL_DO[c(startLL:endLL),] 
str(LL_DO) 
LL_DO <- LL_DO %>% 
  group_by(date) %>% 
  summarize(DO_mg.L = mean(DO_mg.L))#Remove duplicates
missing_data <- LL_DO[!complete.cases(LL_DO),] 
missing_data
```
```{r}
ggplot()+
  geom_line(data = LL_DO, aes(x = date, y = DO_mg.L), color ="#e78429", size = 1) +
  labs(title = "Lower Lawrence Pond DO", x = "Date", y = "Dissolved Oxygen (mg/L)")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16),legend.position = "none")
```

##Combined graphs 
```{r}
mycolors <- met.brewer(name="Archambault",n=5,type="discrete")

colorSC <- c("Alexander" = "#88a0dc", "Stender" = "#7c4b73", 'Durazo' = "#ed968c", 'LowerSeiad' = "#e78429", 'May' = "#f9d14a")
scdo <- ggplot()+
  geom_line(data = AP_DO, aes(x = date, y = DO_mg.L, color ="Alexander"), size = 1) +
  geom_line(data = SP_DO, aes(x = date, y = DO_mg.L, color ="Stender"), size = 1) +
  geom_line(data = Durazo_DO, aes(x = date, y = DO_mg.L, color ="Durazo"), size = 1) +
  geom_line(data = LS_DO, aes(x = date, y = DO_mg.L, color ="LowerSeiad"), size = 1) +
  geom_line(data = May_DO, aes(x = date, y = DO_mg.L, color ="May"), size = 1) +
  labs(title = "Seiad Creek Ponds DO", x = "Date", y = "Dissolved Oxygen (mg/L)", color = "Legend")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16), legend.position = 'right') + 
  scale_colour_manual("", values = c("Alexander" = "#88a0dc", "Stender" = "#7c4b73", 'Durazo' = "#ed968c", 'LowerSeiad' = "#e78429", 'May' = "#f9d14a"))
 
```
```{r}

colorHC <- c("FishGulch" = "#88a0dc", "Goodman" = "#ed968c", 'UpperLaw' = "#f9d14a", 'LowerLaw' = "#e78429")
hcdo <- ggplot()+
  geom_line(data = FG_DO, aes(x = date, y = DO_mg.L, color ="FishGulch"), size = 1) +
  geom_line(data = GP_DO, aes(x = date, y = DO_mg.L, color ="Goodman"), size = 1) +
  geom_line(data = UL_DO, aes(x = date, y = DO_mg.L, color ="UpperLaw"), size = 1) +
  geom_line(data = LL_DO, aes(x = date, y = DO_mg.L, color ="LowerLaw"), size = 1) +
  labs(title = "Horse Creek Ponds DO", x = "Date", y = "Dissolved Oxygen (mg/L)", color = "Legend")+
  scale_y_continuous(limits=c(0,12))+
  theme_classic()+
  theme(text=element_text(size=16), legend.position = 'right') + 
  scale_colour_manual("", values = c("FishGulch" = "#88a0dc", "Goodman" = "#ed968c", 'UpperLaw' = "#f9d14a", 'LowerLaw' = "#e78429"))
 
```


#TABLE S2: DAILY THERMAL BUFFERING 
##Data wrangling
```{r}
#Read in data
quarterHour_condensed <- as.data.frame(t(quarterHour_condensed))

#Create 15 min sequence
quarterHour <- seq(mdy_h('7/1/2020 00'),mdy_h('7/13/2021 00'),by = "15 mins")
quarterHour <- as.data.frame(quarterHour)

#Attach to data frame
quarterHour_condensed <- cbind(quarterHour_condensed,quarterHour)

#Format data long
quarterHour_long <- gather(quarterHour_condensed, site, value, -quarterHour)

#Bin by day
quarterHour_condensed$day <- lubridate::floor_date(quarterHour_condensed$quarterHour, unit="day") 

#Create a function for coefficient of variance (CV)
CV <- function(x){
        (sd(x)/mean(x))*100
}
```

##Individual CVs
```{r}
#Alexander Pond 
AP_CV <- quarterHour_condensed %>%       #15 min data
  group_by(day) %>%                      #Group by day
  dplyr::select(AP) %>%                  #Select site
  summarize(CV = CV(AP))                 #Calculate CV per day for one site
AP_CV_mean <- mean(AP_CV$CV,na.rm=T)     #Take all days as mean over entire year

#Stender Pond
SP_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(SP) %>%
  summarize(CV = CV(SP))
SP_CV_mean <- mean(SP_CV$CV,na.rm=T)

#Durazo Pond
Durazo_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(Durazo) %>%
  summarize(CV = CV(Durazo))
Durazo_CV_mean <- mean(Durazo_CV$CV,na.rm=T)

#Lower Seiad 
LS_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(LS) %>%
  summarize(CV = CV(LS))
LS_CV_mean <- mean(LS_CV$CV,na.rm=T)

#May Pond
May_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(May) %>%
  summarize(CV = CV(May))
May_CV_mean <- mean(May_CV$CV,na.rm=T)

#Fish Gulch
FG_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(FG) %>%
  summarize(CV = CV(FG))
FG_CV_mean <- mean(FG_CV$CV,na.rm=T)

#Goodman Pond
GP_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(GP) %>%
  summarize(CV = CV(GP))
GP_CV_mean <- mean(GP_CV$CV,na.rm=T)

#Upper Lawrence
UL_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(UL) %>%
  summarize(CV = CV(UL))
UL_CV_mean <- mean(UL_CV$CV,na.rm=T)

#Lower Lawrence
LL_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(LL) %>%
  summarize(CV = CV(LL))
LL_CV_mean <- mean(LL_CV$CV,na.rm=T)

#Seiad Creek
SC_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(SC) %>%
  summarize(CV = CV(SC))
SC_CV_mean <- mean(SC_CV$CV,na.rm=T)

#Horse Creek
HC_CV <- quarterHour_condensed %>% 
  group_by(day) %>% 
  dplyr::select(HC) %>%
  summarize(CV = CV(HC))
HC_CV_mean <- mean(HC_CV$CV,na.rm=T)

```

##CV Ratios
```{r}
#CV Ratios are Creeks/Ponds
#No Buffering = <1
#Buffering = >1

#Alexander Pond 
SC_AP <- SC_CV_mean/AP_CV_mean

#Stender Pond
SC_SP <- SC_CV_mean/SP_CV_mean

#Durazo Pond
SC_Durazo <- SC_CV_mean/Durazo_CV_mean

#Lower Seiad 
SC_LS <- SC_CV_mean/LS_CV_mean

#May Pond
SC_May <- SC_CV_mean/May_CV_mean

#Fish Gulch
HC_FG <- HC_CV_mean/FG_CV_mean

#Goodman Pond
HC_GP <- HC_CV_mean/GP_CV_mean

#Upper Lawrence
HC_UL <- HC_CV_mean/UL_CV_mean

#Lower Lawrence
HC_LL <- HC_CV_mean/LL_CV_mean
```

##CV Data Table
```{r}
data.frame(Creek=c("Seiad Creek","Seiad Creek","Seiad Creek","Seiad Creek","Seiad Creek","Horse Creek","Horse Creek","Horse Creek","Horse Creek"),
           CreekCV=round(c(SC_CV_mean,SC_CV_mean,SC_CV_mean,SC_CV_mean,SC_CV_mean,HC_CV_mean,HC_CV_mean,HC_CV_mean,HC_CV_mean),2),
           Pond=c("Alexander","Stender","Durazo","Lower Seiad","May","Fish Gulch","Goodman","Upper Lawrence","Lower Lawrence"),
           PondCV=round(c(AP_CV_mean,SP_CV_mean,Durazo_CV_mean,LS_CV_mean,May_CV_mean,FG_CV_mean,GP_CV_mean,UL_CV_mean,LL_CV_mean),2),
           CV_Ratio=(round(c(SC_AP, 
                        SC_SP,
                        SC_Durazo,
                        SC_LS,
                        SC_May,
                        HC_FG,
                        HC_GP,
                        HC_UL,
                        HC_LL),2)))

```



